# 🧭 二层转发交换机示例

## 📘 示例简介

本示例展示了一个静态配置的二层转发交换机在 P4 数据面语言中的实现。该示例通过静态地将目标 MAC 地址映射到出端口，实现基于以太网帧的基本转发逻辑，是理解
P4 查找表结构和报文匹配-动作编程范式的重要入门案例。

与真实网络设备中使用的 L2 学习算法不同，本示例采用静态表项方式，帮助用户聚焦于表结构设计、元数据处理、匹配字段选择等关键概念。

## 🧱 示例结构

- `main.py`：定义网络拓扑结构，包括一个交换机和四个主机。
- `main.p4`：实现 L2 转发逻辑的 P4 程序。
- `controller.py`：提供基于 P4Runtime 的动态控制平面接口。

## 🔧 示例功能说明

该交换机具备如下功能：

- 解析以太网帧头并进入 `Ingress` 控制流程；
- 匹配以太网帧的目标 MAC 地址，通过查找表决定应使用的出端口；
- 使用 `standard_metadata.egress_spec` 设置出端口；
- 网络结构采用星型拓扑，主机通过一个中心交换机互连。

查找表的设计允许根据 MAC 地址灵活地扩展转发行为，也为后续的动态学习机制奠定基础。

## 🧪 示例行为验证

在当前拓扑配置下，端口与主机的映射关系如下：

| 主机 | MAC 地址              | IP 地址      | 对应端口 |
|----|---------------------|------------|------|
| h1 | `00:00:0a:00:01:01` | `10.0.1.1` | 1    |
| h2 | `00:00:0a:00:01:02` | `10.0.1.2` | 2    |
| h3 | `00:00:0a:00:01:03` | `10.0.1.3` | 3    |
| h4 | `00:00:0a:00:01:04` | `10.0.1.4` | 4    |

基于此配置构建的转发表可实现所有主机间的双向通信。在运行环境启动后，通过 `pingall` 命令应能观察到完整的点对点连通性验证结果。

## 📚 技术要点

- 使用 `P4_16` 标准语法；
- 实现了以太网帧解析、查找表配置、动作执行与 `deparser` 输出；
- 演示了如何在 `.p4` 文件中声明和应用基于 MAC 地址的匹配-动作表；
- 为后续 L2 学习算法、动态表项更新等进阶特性打下基础。
