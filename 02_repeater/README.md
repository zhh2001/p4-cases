# 🔁 中继器示例

## 📘 项目简介
本例展示了一个典型的“数据包中继器”的实现，旨在通过简单的端口映射逻辑，引导初学者理解条件语句与查找表在 P4 控制流程中的应用。该程序实现了一个双端口交换机：当数据包从端口 1 进入时将从端口 2 转发出去，反之亦然。

该示例是 P4 数据面编程的入门级案例之一，适用于教学、实验和基础研究环境中，帮助用户理解 P4 控制块逻辑、元数据处理及表驱动行为。

## 🧱 项目结构

- `main.py`：定义了包含两个主机和一个 P4 交换机的拓扑结构，用于启动 Mininet 仿真环境。
- `main.p4`：完整的 P4 程序，实现了基于入端口进行输出端口决定的逻辑，包含基于条件语句与查找表的两种方式。
- `send.py`：数据发送脚本，用于向目标主机发送单个数据包。
- `receive.py`：接收脚本，用于实时显示接收到的数据包内容。

## 🚀 功能说明

该交换机具备以下数据面处理能力：

- 能够解析以太网帧并进入 `Ingress` 控制流程；
- 根据入端口的值决定数据包的出端口，实现单向映射逻辑（1→2，2→1）；
- 支持两种实现方式：
  - **方式一**：使用条件判断（`if-else`）结构直接设置 `standard_metadata.egress_spec`；
  - **方式二**：通过查找表匹配 `ingress_port`，并调用设置出端口的动作；
- 可由控制器通过 P4Runtime 动态下发查找表项。

该逻辑模拟了传统硬件网络中简化的“信号中继器”功能，是理解端口转发与查表机制的关键起点。

## 🧪 验证方式

在拓扑启动后，主机之间的通信应满足以下行为：
- 从 `h1` 发送的数据包应由交换机转发至 `h2`；
- 从 `h2` 发送的数据包应由交换机转发至 `h1`；
- 可使用 `send.py` 与 `receive.py` 进行测试；
- 亦可使用 `ping`、`iperf` 等工具进一步验证通道连通性与传输性能。

示例运行后可观察到其中一台主机成功接收到另一台发出的自定义报文，验证中继器逻辑运行正确。

📚 技术要点
- 使用标准 `P4_16` 语法；
- 演示 `standard_metadata.ingress_port` 与 `standard_metadata.egress_spec` 的基本应用；
- 结合控制器进行查找表项的动态配置；
- 为后续的多表匹配、条件路由等高级主题打下基础。
